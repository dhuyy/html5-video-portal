/* eslint angular/timeout-service: 0 */
!function(){"use strict";angular.module("crossoverAssignment",["ngAnimate","ngSanitize","ngMessages","LocalStorageModule","angular-input-stars","ngAria","ui.router","angular-md5","toastr"]),setTimeout(function(){angular.bootstrap(document,["crossoverAssignment"])},2e3)}(),function(){"use strict";function e(e,o){function i(i,n,t){return e({method:"GET",url:o.ADDRESS+"/videos",headers:{"Content-Type":"application/json"},params:{sessionId:i,skip:n,limit:t}})}function n(i,n){return e({method:"GET",url:o.ADDRESS+"/video",headers:{"Content-Type":"application/json"},params:{sessionId:i,videoId:n}})}function t(i,n,t){return e({method:"POST",url:o.ADDRESS+"/video/ratings",headers:{"Content-Type":"application/json"},params:{sessionId:i},data:{videoId:n,rating:t}})}var s={getVideos:i,getVideo:n,rateVideo:t};return s}e.$inject=["$http","SERVER"],angular.module("crossoverAssignment").factory("VideoService",e)}(),function(){"use strict";var e={bindings:{videoId:"@",name:"@",description:"@",url:"<"},controller:["$scope","$element","$rootScope","SERVER",function(e,o,i,n){var t=null;this.$onInit=function(){var e=angular.element(o).find("video");e.on("play",function(){angular.forEach(angular.element("video"),function(o){e.get(0).id!=o.id&&o.pause()})})},this.$onChanges=function(){this.url=n.ADDRESS.concat("/",this.url)},this.onRatingClick=function(){0==e.videoRating&&(e.videoRating=t),t=e.videoRating,i.$emit("onRatingClick",{videoId:this.videoId,rating:e.videoRating})}}],templateUrl:"app/components/videoPlayer/videoPlayer.html"};angular.module("crossoverAssignment").component("videoPlayer",e)}(),function(){"use strict";function e(e){return{restrict:"E",bindToController:{videoId:"@",name:"@",description:"@",url:"<",ratings:"<"},scope:{},controller:["$scope","$rootScope",function(o,i){function n(e){var o=e.reduce(function(e,o){return e+o});return o/e.length}function t(e,o){o||(o=1);var i=1/o;return Math.round(e*i)/i}function s(){o.averageRate=t(n(a.ratings),.5)}function r(){a.url=e.ADDRESS.concat("/",a.url)}var a=this;a.average=n,a.round=t,a.goToVideoDetail=function(){i.$emit("onClickDetailVideo",a.videoId)},a.onInit=function(){s(),r()}}],controllerAs:"$ctrl",templateUrl:"app/components/videoBlock/videoBlock.html",link:function(e,o){function i(){var e=angular.element(o).find("video");e.on("play",function(){angular.forEach(angular.element("video"),function(o){e.get(0).id!=o.id&&o.pause()})})}!function(){i()}()}}}e.$inject=["SERVER"],angular.module("crossoverAssignment").directive("videoBlock",e)}(),function(){"use strict";var e={bindings:{isLogged:"<"},controller:["$rootScope",function(e){function o(){e.$emit("logout")}this.onClickLogout=o}],templateUrl:"app/components/navbar/navbar.html"};angular.module("crossoverAssignment").component("crossoverNavbar",e)}(),function(){"use strict";function e(e){var o={restrict:"C",link:function(o,i,n){e.enabled(!0),e.leave(i.children().eq(0)).then(function(){i.remove(),o=i=n=null,e.enabled(!1)})}};return o}e.$inject=["$animate"],angular.module("crossoverAssignment").directive("loadingScreen",e)}(),function(){"use strict";function e(e,o,i,n){function t(n,t){return e({method:"POST",url:i.ADDRESS+"/user/auth",headers:{"Content-Type":"application/json"},data:{username:n,password:o.createHash(t)}})}function s(o){return e({method:"GET",url:i.ADDRESS+"/user/logout",headers:{"Content-Type":"application/json"},params:{sessionId:o}})}function r(){return n.get("sessionId")}var a={auth:t,logout:s,getSessionId:r};return a}e.$inject=["$http","md5","SERVER","localStorageService"],angular.module("crossoverAssignment").factory("AuthService",e)}(),function(){"use strict";function e(e,o,i,n,t){function s(){l.getVideos(n.getSessionId(),l.videos.length,c)}function r(n,s,r){t.getVideos(n,s,r).then(function(o){l.videos=l.videos.concat(o.data.data),l.showSpinner=!1,d&&(e(function(){a()}),d=!1)})["catch"](function(){i.error(null,"Could not load videos."),o.go("login")})}function a(){scrollMonitor.create(document.getElementById("video-list-end")).enterViewport(function(){l.videos.length<101&&(l.showSpinner=!0,l.getVideos(n.getSessionId(),l.videos.length,c))})}var l=this,c=10,d=!0;l.videos=[],l.showSpinner=!1,l.onInit=s,l.getVideos=r}e.$inject=["$timeout","$state","toastr","AuthService","VideoService"],angular.module("crossoverAssignment").controller("VideoListController",e)}(),function(){"use strict";function e(e,o,i,n){function t(){l.getVideo(n.getSessionId(),e.id)}function s(e,t){i.getVideo(e,t).then(function(e){l.video=e.data.data,l.getVideos(n.getSessionId(),l.videos.length,c)})["catch"](function(){o.error(null,"Could not load video ".concat(t,"."))})}function r(e,n,t){i.getVideos(e,n,t).then(function(e){var o=e.data.data;l.videos=l.videos.concat(o),o=o.filter(function(e){return e._id!=l.video._id}),l.results=l.results.concat(o)})["catch"](function(){o.error(null,"Could not load videos.")})}function a(){l.getVideos(n.getSessionId(),l.videos.length,c)}var l=this,c=5;l.video=null,l.videos=[],l.results=[],l.onInit=t,l.getVideo=s,l.getVideos=r,l.showMoreSideVideos=a}e.$inject=["$stateParams","toastr","VideoService","AuthService"],angular.module("crossoverAssignment").controller("VideoDetailController",e)}(),function(){"use strict";function e(e,o,i,n){function t(t,s){o.auth(t,s).then(function(o){"error"==o.data.status?i.error(null,o.data.error):(n.set("sessionId",o.data.sessionId),e.go("videoList"))})["catch"](function(){i.error(null,"Could not connect to server. Try again later.")})}var s=this;s.auth=t}e.$inject=["$state","AuthService","toastr","localStorageService"],angular.module("crossoverAssignment").controller("LoginController",e)}(),function(){"use strict";function e(){return function(e){return e.substring(0,85).concat("...")}}angular.module("crossoverAssignment").filter("truncateDescription",e)}(),function(){"use strict";function e(e,o,i,n,t,s){var r=o.$on("$stateChangeSuccess",function(o,t){"private"!==t.permission||n.get("sessionId")||(e.go("login"),i.error(null,"Not authorized. Try to sign in again."))});o.$on("$destroy",r),o.isLogged=function(){return!!n.get("sessionId")};var a=o.$on("logout",function(){t.logout(t.getSessionId()).then(function(){n.remove("sessionId"),e.go("login")})});o.$on("$destroy",a);var l=o.$on("onClickDetailVideo",function(o,i){e.go("videoDetail",{id:i})});o.$on("$destroy",l);var c=o.$on("onRatingClick",function(e,o){s.rateVideo(t.getSessionId(),o.videoId,o.rating).then(function(){i.success(null,"VÃ­deo rated.")})["catch"](function(){i.error(null,"Could not rate this video.")})});o.$on("$destroy",c)}e.$inject=["$state","$rootScope","toastr","localStorageService","AuthService","VideoService"],angular.module("crossoverAssignment").run(e)}(),function(){"use strict";function e(e,o){e.state("login",{url:"/login",templateUrl:"app/login/login.html",controller:"LoginController",controllerAs:"vm",permission:"public"}).state("videoList",{url:"/videoList",templateUrl:"app/videoList/videoList.html",controller:"VideoListController",controllerAs:"vm",permission:"private"}).state("videoDetail",{url:"/videoDetail/:id",templateUrl:"app/videoDetail/videoDetail.html",controller:"VideoDetailController",controllerAs:"vm",permission:"private"}),o.otherwise("/login")}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("crossoverAssignment").config(e)}(),function(){"use strict";angular.module("crossoverAssignment").constant("SERVER",{ADDRESS:"crossover-assignment-angular.herokuapp.com/user/auth"})}(),function(){"use strict";function e(e,o){o.setPrefix("crossOver"),o.setDefaultToCookie(!1),e.allowHtml=!0,e.timeOut=2e3,e.positionClass="toast-top-right",e.preventDuplicates=!1,e.progressBar=!0,e.closeButton=!0}e.$inject=["toastrConfig","localStorageServiceProvider"],angular.module("crossoverAssignment").config(e)}(),angular.module("crossoverAssignment").run(["$templateCache",function(e){e.put("app/login/login.html",'<div class=login-page><div class=account-wall><img class=profile-img src=../../assets/images/avatar.png alt=""><form class=form-login ng-submit="vm.auth(vm.username, vm.password)"><input type=text class=form-control placeholder=Username ng-model=vm.username required autofocus> <input type=password class=form-control placeholder=Password ng-model=vm.password required> <input type=submit class="btn btn-lg btn-info btn-block btn-login" value="Sign In"></form></div></div>'),e.put("app/videoDetail/videoDetail.html",'<div class="video-detail-page container-fluid" ng-init=vm.onInit()><div class=row><div class="col-xs-12 col-sm-8"><div class=video-player-wrapper><video-player video-id="{{ vm.video._id }}" name="{{ vm.video.name }}" description="{{ vm.video.description }}" url=vm.video.url></video-player></div></div><div class="col-xs-12 col-sm-4"><hr class="separator visible-xs-block"><div class=side-video-list><video-block ng-repeat="video in vm.results" video-id="{{ video._id }}" name="{{ video.name }}" description="{{ video.description }}" url=video.url ratings=video.ratings></video-block><button class="btn bnt-lg btn-default btn-show-more" ng-click=vm.showMoreSideVideos()>Show More</button></div></div></div></div>'),e.put("app/videoList/videoList.html",'<div class=video-list-page><div class=video-list ng-init=vm.onInit()><div class=video-wrapper ng-repeat="video in vm.videos"><video-block video-id="{{ video._id }}" name="{{ video.name }}" description="{{ video.description }}" url=video.url ratings=video.ratings></video-block></div></div><div id=video-list-end><img class=spinner ng-show=vm.showSpinner src=../../assets/images/spinner.gif alt=""></div></div>'),e.put("app/components/navbar/navbar.html",'<div class=container-fluid><div class=row><nav class="navbar navbar-default crossover-navbar"><div class=navbar-header><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#navbar-collapse aria-expanded=false><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand href=/#/videoList><img src=../../../assets/images/header-logo.png alt=Crossover></a></div><div class="collapse navbar-collapse" id=navbar-collapse><ul class="nav navbar-nav navbar-right"><li ng-if=!$ctrl.isLogged><a href=/#/login><i class="fa fa-sign-in" aria-hidden=true></i> Login</a></li><li ng-if=$ctrl.isLogged ng-click=$ctrl.onClickLogout()><a href=""><i class="fa fa-sign-out" aria-hidden=true></i> Logout</a></li></ul></div></nav></div></div>'),e.put("app/components/videoBlock/videoBlock.html",'<div class=video-block ng-init=$ctrl.onInit()><video id="{{ $ctrl.videoId }}" ng-src="{{ $ctrl.url }}" preload=none poster=../../../assets/images/default-thumb-small.png class=video-block-el controls></video><div class=video-info><p class=video-name ng-click=$ctrl.goToVideoDetail()>{{ $ctrl.name }}</p><div class=video-rating-wrapper><span class=rating-label>Rating:</span><input-stars allow-half readonly class=average-rating max=5 ng-model=averageRate></input-stars></div><div class=video-description>{{ $ctrl.description | truncateDescription }} <a href="" ng-click=$ctrl.goToVideoDetail()>Read more</a></div></div></div>'),e.put("app/components/videoPlayer/videoPlayer.html",'<div class=video-player><video id="{{ $ctrl.videoId }}" ng-src="{{ $ctrl.url }}" preload=none poster=../../../assets/images/default-thumb.png class=video-player-el controls></video><div class=video-info><p class=video-name ng-click=$ctrl.goToDetail()>{{ $ctrl.name }}</p><div class=video-rating-wrapper><span class=rating-label>Rating</span><input-stars class=average-rating max=5 on-star-click=$ctrl.onRatingClick() ng-model=videoRating></input-stars></div><div class=video-description-wrapper><span class=description-label>Description:</span><div class=video-description>{{ $ctrl.description }}</div></div></div></div>')}]);
//# sourceMappingURL=../maps/scripts/app-4fe376b231.js.map
